suite: test backend deployment
templates:
  - backend-deployment.yaml
tests:
  - it: should create backend deployment with correct image
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-fk-app-stack-backend
      - equal:
          path: spec.template.spec.containers[0].image
          value: "ghcr.io/forsakringskassan/template-quarkus-app:snapshot"
      - equal:
          path: spec.template.spec.containers[0].ports[0].containerPort
          value: 8080

  - it: should have correct labels
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/component"]
          value: backend
      - equal:
          path: spec.selector.matchLabels["app.kubernetes.io/component"]
          value: backend

  - it: should have health checks configured
    asserts:
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.path
          value: /q/health/live
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.path
          value: /q/health/ready

  - it: should respect resource limits
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources.limits.cpu
          value: 500m
      - equal:
          path: spec.template.spec.containers[0].resources.limits.memory
          value: 512Mi